<?php

///////////////////////////////////////////////////////////////////////////////////////////////////
/* WORKING DIR constant *//////////////////////////////////////////////////////////////////////////

define('DIR', str_replace('/www/api', '', dirname(__FILE__)));

///////////////////////////////////////////////////////////////////////////////////////////////////
/* autoload CLASS definitions *////////////////////////////////////////////////////////////////////

spl_autoload_register(function ($class_name) {
	require_once DIR . "/www/api/class.".$class_name.".php";
});


///////////////////////////////////////////////////////////////////////////////////////////////////
/* Requests from the same server don't have a HTTP_ORIGIN header */////////////////////////////////

if (!array_key_exists('HTTP_ORIGIN', $_SERVER)) {

    $_SERVER['HTTP_ORIGIN'] = $_SERVER['SERVER_NAME'];
}


///////////////////////////////////////////////////////////////////////////////////////////////////
//* RUN *//////////////////////////////////////////////////////////////////////////////////////////
try {

	$API = new MyAPI($_REQUEST['request'], $_SERVER['HTTP_ORIGIN']);
	echo $API->processAPI();
}

catch (Exception $e) {

	echo json_encode(Array('error' => $e->getMessage()));
}

?>