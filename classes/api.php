<?php

require_once "helpers/functions.php";

///////////////////////////////////////////////////////////////////////////////////////////////////
//* CONSTANTs *////////////////////////////////////////////////////////////////////////////////////
define('DIR', str_replace('/classes', '', dirname(__FILE__)));

///////////////////////////////////////////////////////////////////////////////////////////////////
//* autoload CLASS definitions *///////////////////////////////////////////////////////////////////
spl_autoload_register(function ($class_name) {
	require_once DIR . "/classes/class.".$class_name.".php";
});


///////////////////////////////////////////////////////////////////////////////////////////////////
//* Requests from the same server don't have a HTTP_ORIGIN header *////////////////////////////////
if (!array_key_exists('HTTP_ORIGIN', $_SERVER)) {
    $_SERVER['HTTP_ORIGIN'] = $_SERVER['SERVER_NAME'];
}

///////////////////////////////////////////////////////////////////////////////////////////////////
//* RUN *//////////////////////////////////////////////////////////////////////////////////////////
try {
	$API = new MyAPI($_REQUEST['request'], $_SERVER['HTTP_ORIGIN']);
	$ret = trim($API->processAPI());

	// if ( !$ret ) header('HTTP/1.0 403 Forbidden');
	if ( !empty($ret) ) echo $ret . PHP_EOL;
}

catch (Exception $e) {
	echo var_export($e->getMessage(), true);
}
///////////////////////////////////////////////////////////////////////////////////////////////////

?>
